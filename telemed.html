<!DOCTYPE html>
<html>
<head>
  <title>SAH Video Call</title>
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: sans-serif;
    }
    #video-container {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      background: #f0f0f0;
    }
    video {
      width: 45%;
      height: auto;
      margin: 1%;
      border-radius: 8px;
    }
    .video-box {
      width: 45%;
      background: black;
      margin: 1%;
      border-radius: 8px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="video-container">
    <div id="local-stream" class="video-box"></div>
    <div id="remote-streams" class="video-box"></div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const appId = '9215eef13c1f4b8b88b20e217e027462';
    const channel = urlParams.get('channel') || 'test';
    const uid = urlParams.get('user') || null;

    const client = AgoraRTC.createClient({ mode: 'rtc', codec: 'vp8' });

    async function startCall() {
      await client.join(appId, channel, null, uid);

      const [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks();

      const localContainer = document.createElement('div');
      localContainer.id = uid || 'local-user';
      document.getElementById('local-stream').appendChild(localContainer);
      cameraTrack.play(localContainer.id);

      await client.publish([microphoneTrack, cameraTrack]);

      client.on('user-published', async (user, mediaType) => {
        await client.subscribe(user, mediaType);
        let remoteContainer = document.getElementById(`user-${user.uid}`);
        if (!remoteContainer) {
          remoteContainer = document.createElement('div');
          remoteContainer.id = `user-${user.uid}`;
          remoteContainer.className = 'video-box';
          document.getElementById('remote-streams').appendChild(remoteContainer);
        }

        if (mediaType === 'video') {
          user.videoTrack.play(remoteContainer);
        }
        if (mediaType === 'audio') {
          user.audioTrack.play(); // Audio doesnâ€™t need a DOM element
        }
      });

      client.on('user-unpublished', (user) => {
        const remote = document.getElementById(`user-${user.uid}`);
        if (remote) remote.remove();
      });
    }

    startCall();
  </script>
</body>
</html>

